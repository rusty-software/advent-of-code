create table aoc_day03 (treeline varchar(32));

insert into aoc_day03 values
('.......#..#....#...#...#......#')
,('..##..#...##.###.#..#.....#.#..')
,('#..#.#....#......#..#.........#')
,('.#..##...#........#....#..#..#.')
,('#.#.#....###...#........#.....#')
,('.#...#.#.##.#.##...#.#.........')
,('####......#.......###.##.#.....')
,('..#...........#...#.#.#........')
,('.#.......#....###.####..#......')
,('...##........#....##.......##..')
,('.###......##.#......##....#.#.#')
,('........#.#......##...#......#.')
,('#....##.#..#...#.......#.......')
,('.#..##........##.........#....#')
,('.#..#..#...#....#.#......#.#...')
,('..#.#......##.#.......#....##..')
,('......##......#.#..##.#..#...#.')
,('.....##.......#.#....#.#.......')
,('........#.....#.....#..###.#...')
,('#........#..#.....#...#.#.#..#.')
,('.#..#.....#...#........#.....#.')
,('.#.#.....#.....#...#...........')
,('.....#.#..#..#...#..#..#..##..#')
,('##.#...#....#..#.##..#.....#.#.')
,('#.......####......#..#.#....#..')
,('......#.#...####.........#.#..#')
,('.#.........#..#.#...#..........')
,('...#####.#....#.#..#......#.#.#')
,('##....#.###....##...##..#.....#')
,('...........####.##.#....##.##..')
,('#.#.#..........#.#..##.#.######')
,('##...#..#...........###..#....#')
,('.#.#.#...##..........##.#...#..')
,('...#.#........#..##...#....#...')
,('......#..#...#..##....#.......#')
,('.#..#.......#..#......##....##.')
,('.......#.......#........#..##..')
,('...#...#...#.##......#.##.#....')
,('.........#.........#.#.#.##....')
,('..#...................#....#..#')
,('.........#..#.....#.#...#....#.')
,('#.#.#...#........#..###.#......')
,('#.#.#.####......##...#...#....#')
,('#...........##..#.#.#....#..#..')
,('........#..#.#...........##.#.#')
,('.#.........#...........#..#....')
,('#............##.#..#....##...##')
,('.#....##..#.#....#.......#..#..')
,('..#.#...#.#......####.......#..')
,('...#.#.......###......#.....#..')
,('#......#.......#.#...#.#..##...')
,('...#.....#...##.#.....#.#......')
,('#.#.#............#..#......#..#')
,('....#...#...##.##.##...##.#....')
,('..##........#..#........#...##.')
,('.......#..#...#.........#.....#')
,('...........#.#......#...#......')
,('...##..##..##..###..#..#..#..#.')
,('#..##.......##..#....#....#.#..')
,('#.#.##.#..##.....#....#.#......')
,('....#..##......#.#..#....#....#')
,('.#.#.........##...#......##.##.')
,('##...........#..#.....#.###....')
,('.#.###........#...#....##..#...')
,('......##.....#.................')
,('.#.##..#.#.......#......#.#.#..')
,('.#...#....#.##..........##.##..')
,('#...##......####.#....#....#...')
,('.#...#.##.#.#.....#...#........')
,('.#................#.##.#.###...')
,('...#.#..#.#.....##.....##....#.')
,('..##.#..#..##.....#....#...#.##')
,('........###.##..#..###.....#..#')
,('..##.....#.......#.#...##......')
,('#.#..###...##.###.##.#..#...#..')
,('#..#..#.#...#....#...##.....#.#')
,('#..................#........#..')
,('#.....#.......#.##....##....#..')
,('...#.............#.....#...#...')
,('...#...#.##..##.....#........#.')
,('.......#........##....###..##..')
,('.#....#....#.#..#......#....#.#')
,('..........#..#.#.....##...#.##.')
,('.#...##.#...........#.#.......#')
,('..#.##.....#.###.#.............')
,('..#....###..........#.#.#......')
,('#.....#.####..#.#......#..#.#.#')
,('...#........#..#...............')
,('.###.#.##.....#.#...........#..')
,('..#....#..#....#..##....#......')
,('......#..#.....#.#.##.......#.#')
,('###..#...#.#..#....#..##.###..#')
,('.#....##.###........##...##.#.#')
,('........##..##.#....##..#....#.')
,('...#..#....#.#....#...#...##...')
,('#.....#......#.##........#....#')
,('....#....###.##...#.#.##....#..')
,('......#.##..#.#..........#...#.')
,('...........#...#....##...#....#')
,('......#.#.........#....#.#.#...')
,('.###..........#.###.##....#...#')
,('...##.......#......#....#....#.')
,('#..#...#.#..####...#......#..#.')
,('....##..#.#.........#..........')
,('.##.###.##....##.####....#...#.')
,('..##.......#........#...#..#...')
,('....#####..........###....#....')
,('.#.#..#.#.#....#..#............')
,('........#.....#....#.......##..')
,('...........##....##..##.....##.')
,('..###........#.#.#..#....##...#')
,('.....#...........##......#..#..')
,('...##........#.##.#......##..#.')
,('##..#....#............##..#..#.')
,('.#.....#...##.##..............#')
,('#..##........#...#...#......##.')
,('......##.....#.......####.##..#')
,('...#.#....#...#..#.............')
,('..#...#..##.###..#..#.......##.')
,('##....###.......#...#..#.......')
,('#..#.....###.....#.#.........#.')
,('#.#....#.............#...#.....')
,('..#.#.##..........#.....##.#...')
,('.....##......#..#..#.....#..#..')
,('##.#..#..#.##......###....#..#.')
,('...#............##...#..##.....')
,('.#..#....#.........#......#.##.')
,('.##.##...#..............#..#.##')
,('...#....#...###...#...#....#..#')
,('..#...#..####..#....#.#...##..#')
,('..............##.##.......##...')
,('..##.#..##...........#.#.#...#.')
,('..................##.####.###..')
,('.#...........#.......#......#..')
,('.#.#.#...#....#.........##...##')
,('....#..........#.#....#.#.....#')
,('..........#.#..........#.#.....')
,('...........#.....#.#......#....')
,('........#..#.#.#.#.............')
,('...###...##...##..####.##......')
,('.#..#......###.....#...#.....#.')
,('.........##............#.#.....')
,('#.#..#.#.#....###.#.#..#..#..##')
,('..........#...#.##.#..#..#....#')
,('#..#.......##....#..##........#')
,('##.#...#....##.............#...')
,('....#........#......##..#..#.##')
,('.................#.#.#.#.#.....')
,('...........#.#.....#.......#...')
,('#.......#.......#............#.')
,('....#...........#.#.##.....#..#')
,('#...#.....#....#..##...#.......')
,('..#.....#.....#.##.##....#.....')
,('.#.#..#...#..#..##.....##..#...')
,('.#.#....#.........####.........')
,('#...#..####.....#...#..##......')
,('..#...##.#.....#...#.....##....')
,('.#...#.....#.#.#......#.......#')
,('..#.....##.#..#.#...##.........')
,('##.#...#..#....#....#.##.##...#')
,('.#..#....#..##.#.......#..#....')
,('...##.#......#...###.......#...')
,('...#..#.........##.####........')
,('#.#..#..##...........#..#......')
,('.#...#.#......#.#..........#...')
,('...###...#.......#.....#.#...##')
,('..#....#.#.##..........##...#..')
,('.....###.........#.....#..##..#')
,('.......##.....#.#.....#.#..##..')
,('.#.#.###..##.......##...#......')
,('......#.....#................##')
,('.#......##..##.#.#...#...#...##')
,('.#...#......#.......#.#........')
,('.#..........###...#..#...#.....')
,('.........##.....#.#..#..#.#...#')
,('#...#...#.........#..#..#....#.')
,('###.......#.#.....#....##......')
,('.#..#......#..#...........#..#.')
,('..##....##..##...#......#......')
,('.#........#....#...#....#.....#')
,('.#.......#...#...#..##.#.#..#..')
,('#...#........#.##.....#.....#..')
,('#..##.....#..........#...#...##')
,('............#...............#..')
,('.#.##...#.....#.#..#..#..#.....')
,('.#.#.#...#........#....#...##..')
,('##......#.....#.###.#...#.#..#.')
,('.........##..#..#.#...#...#...#')
,('#...#.#....#..#..#.....#.......')
,('.......#.###...#.............#.')
,('..#.....#.#.#..###.#....#.....#')
,('....#...#.#....#.#..........#..')
,('..#......#.###.#.#..#.....#...#')
,('#............#..##...##......#.')
,('#...........#..#....#.###..###.')
,('.#.##.#.#.......#.............#')
,('..............#................')
,('..#.#.....#.....#...#......#...')
,('.#.#.#..#..#.#...........##....')
,('.....##.#......#..#.##....#....')
,('.......##..#.#.#..#............')
,('..#.....#.....#.###..#.....#.#.')
,('......##.....#..##.#...#.....#.')
,('...#...#....#..#..#........#...')
,('..#.##..#....#.........#.#..#..')
,('#....#.....###.....#......#....')
,('##.....#..#..##.........#.##.##')
,('.#.#....#.#..........#.........')
,('.##.#...#..#.......#.##...#....')
,('...#...#.....#....#...#.#..#...')
,('.....#....#.....#.....#.#......')
,('...........#.#.......#.......#.')
,('.........##.###.##........#....')
,('#..##.....#...#.#..............')
,('.#...#....##........#.#..#....#')
,('..#...#........#...#..#.##.#..#')
,('........#...#.....##.#.#....#.#')
,('#..#.......###.#....#.#.#......')
,('.......#...##....#...#..##..#..')
,('.....##........#.#.#..#....##..')
,('.#....#..#.#...........#......#')
,('...##....#.##.....##.......#...')
,('.##..#..#....#.#....#..#....##.')
,('..#....#.....###.......#..##..#')
,('....#.......#....##..#....#..##')
,('....#......##..#....#.#...#.#..')
,('.##.#......##..................')
,('##.#....#........#..#..#...##.#')
,('.......#..#.#...##.....#.#.....')
,('..##.#...........#.#.#..#.#.#..')
,('.....#....#......#..#.......#..')
,('#.#...#.####..##.......#..##...')
,('...#....#.....#.##.#..#.##..#..')
,('.#.......#......##........##.#.')
,('.......#.#...#..#...#..##.#....')
,('.#....#........#.#.....##..#..#')
,('#..#.....#..#.............#...#')
,('#...#....#..#...###..#...#.#...')
,('.#..#.....#..........#..##.####')
,('#.#.#.#.##.#.#.....##.#........')
,('...#....##....#...#..##.......#')
,('..##.##.#.#........#..........#')
,('..###........###..#..........#.')
,('...#......#..##.#........#..#..')
,('#.#.#..#........#..#..........#')
,('...#........#..##.#...#.###....')
,('##......#.####.#....#......#...')
,('.#..#......#................#..')
,('#.#........#.#.....##.....##...')
,('#...............#..#.......#.#.')
,('.##..#...........##..#..#.#....')
,('#......#.#.......#.#.#.##..#.##')
,('.....##.#..###.............##..')
,('....##.........#..#...#........')
,('.....#.....#.#.#..#.#..........')
,('#.........#....##.#.##.....#..#')
,('.#.........#......#.#.##.#.#...')
,('##.........#.....#..#.#..#.##.#')
,('....#......##...#.....#..#..###')
,('..#..............#...#..####...')
,('#....#...##.#.......#...#..#...')
,('#.......###.#.#.......#.......#')
,('...##....#.#...........#...###.')
,('...........#..#.#.....#..##..#.')
,('..#.........#..###..#.....#...#')
,('..#.#.....#.#.#...#.#.#......#.')
,('........#.....#.#......##....##')
,('##.#.#...#.#........#.....#...#')
,('........#....#...............#.')
,('##.###......####...#####..#....')
,('...##...#..#....#........#...#.')
,('...###.#..................##.#.')
,('##.#.......###.......#...#.#...')
,('....#..#.#...#...#....#.#.#..##')
,('....#...........#..#...........')
,('#..#.#..#...#...#..#...........')
,('...#...#.#....#..#....#........')
,('#....#.......#.##........#..#..')
,('.....#...#..#................#.')
,('#......#.......#..........##..#')
,('.#....#.#......#.#...#....##..#')
,('...#.##...#......#.#...##...##.')
,('..#...#..##...#...#....#.......')
,('.....#....#.#.#..........#.#...')
,('...#...#..#....#..#.#..........')
,('......#.#..........##.......#..')
,('.#...##.#.#...#..##..#...#.....')
,('..#..#.........#........#.#.#..')
,('#.#..##..#.....##......#.....#.')
,('#..#.....#.#....#...#.#....#.#.')
,('......#........##.#..#...#.....')
,('...#.##.#.#......#.#..##...#..#')
,('....#..###..#..#.....###....##.')
,('.....#...#.#.....#..........#.#')
,('.#...##..##.....#..#...#.#.#...')
,('.##.#......##...##..#...#.....#')
,('.#.##....#...#.##.#.#...#.#...#')
,('....#.#...#....###.#.....#.....')
,('#.....####................#..#.')
,('....#.....#...#.#.......##.#...')
,('.#...##.#...#..#...........#.#.')
,('..#####..#.#...#...##........#.')
,('...#...##........#...#.#....###')
,('........#.#.#..#.....#.......#.')
,('...#...#..##............##.....')
,('#.#..###....###.#...#.#...##.##')
,('..#.##...#......#..#.........##')
,('.##..#..#.....#..#.........#.#.')
,('.#..#.#....#.##...#..#.##....##')
,('..#...#.#...##.#.#...#...#....#')
,('#..........#.......##..##....#.')
,('#...###.#......#....#.........#')
,('#.....#...##.......##....##....')
,('.##.#..#.##......#.##....#..#..')
,('............#.#....##.#..#....#')
,('.#.........##.##...#....#.....#')
,('##....##..#..#....##...#.....##')
,('...#.....#...........#.....##..')
,('......#...#.........#.......#..')
,('............#...##.#.....#.#.#.')
,('.#........##..........#.....#.#')
,('.###.........#.....#.##...#....')
,('.##..#...##...#..#..#.##.......');

do 
$$
declare 
    idx int = 1;
    char_at_idx varchar(1);
    tree_count int = 0;
    rec record;
begin
    for rec in 
        select repeat(treeline, 50) as repeated_treeline from aoc_day03
    loop
        if idx = 1 then
            idx := idx + 3;
            continue;
        end if;
        
        if (substring(rec.repeated_treeline, idx, 1) = '#') then
            tree_count := tree_count + 1;
        end if;

        idx := idx + 3;
    end loop;

    raise notice 'TREE COUNT: %', tree_count;
end;
$$
/*
NOTICE:  00000: TREE COUNT: 234
*/

create or replace function tree_count(x_step int, y_step int)
    returns bigint as 
$$
declare 
    x_idx int = 1;
    y_idx int = 1;

    char_at_idx varchar(1);
    tree_count int = 0;
    rec record;
begin
    for rec in 
        select repeat(treeline, 100) as repeated_treeline from aoc_day03
    loop
        if x_idx = 1 then
            x_idx := x_idx + x_step;
            y_idx := y_idx + 1;
            continue;
        end if;
        if y_step  1 and mod((y_idx - 1), y_step) <> 0 then
            y_idx := y_idx + 1;
            continue;
        end if;
        
        if (substring(rec.repeated_treeline, x_idx, 1) = '#') then
            tree_count := tree_count + 1;
        end if;

        x_idx := x_idx + x_step;
        y_idx := y_idx + 1;
    end loop;

   return tree_count;
end;
$$
language plpgsql;

select tree_count(1, 1) * tree_count(3, 1) * tree_count(5, 1) * tree_count(7, 1) * tree_count(1, 2);
/*
  ?column?  
------------
 5813773056
(1 row)
*/
